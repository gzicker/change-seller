"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Checkout = void 0;
const api_1 = require("@vtex/api");
const request_1 = require("../utils/request");
const request_keys_1 = require("../utils/request_keys");
const baseURL = '/api/checkout';
const routes = {
    addItem: (orderFormId, queryString) => `${baseURL}/pub/orderForm/${orderFormId}/items${queryString}`,
    cancelOrder: (orderFormId) => `${baseURL}/pub/orders/${orderFormId}/user-cancel-request`,
    orderFormCustomData: (orderFormId, appId, field) => `${baseURL}/pub/orderForm/${orderFormId}/customData/${appId}/${field}`,
    updateItems: (orderFormId) => `${baseURL}/pub/orderForm/${orderFormId}/items/update`,
    profile: (orderFormId) => `${baseURL}/pub/orderForm/${orderFormId}/profile`,
    attachmentsData: (orderFormId, field) => `${baseURL}/pub/orderForm/${orderFormId}/attachments/${field}`,
    assemblyOptions: (orderFormId, itemId, assemblyOptionsId) => `${baseURL}/pub/orderForm/${orderFormId}/items/${itemId}/assemblyOptions/${assemblyOptionsId}`,
    checkin: (orderFormId) => `${baseURL}/pub/orderForm/${orderFormId}/checkIn`,
    orderForm: (orderFormId) => `${baseURL}/pub/orderForm/${orderFormId !== null && orderFormId !== void 0 ? orderFormId : ''}`,
    orders: `${baseURL}/pub/orders`,
    simulation: () => `${baseURL}/pub/orderForms/simulation`,
    changeToAnonymousUser: (orderFormId) => `/checkout/changeToAnonymousUser/${orderFormId}`,
    orderFormConfiguration: `${baseURL}/pvt/configuration/orderForm`,
    singleCustomData: (orderFormId, appId, appFieldName) => `${baseURL}/pub/orderForm/${orderFormId}/customData/${appId}/${appFieldName}`,
    clientProfile: (email) => `http://portal.vtexcommercestable.com.br${baseURL}/pub/profiles?email=${email}`,
    createTransaction: (account, transactionId) => `https://${account}.vtexpayments.com.br/api/pvt/transactions/${transactionId}/payments`,
};
class Checkout extends api_1.JanusClient {
    constructor(ctx, options) {
        super(ctx, {
            ...options,
        });
    }
    getOrderFormConfiguration(authMethod = 'AUTH_TOKEN', tracingConfig) {
        const metric = 'checkout-getOrderFormConfiguration';
        return this.http.get(routes.orderFormConfiguration, request_1.getRequestConfig(this.context, authMethod, metric, tracingConfig));
    }
    setOrderFormConfiguration(body, authMethod = 'AUTH_TOKEN', tracingConfig) {
        const metric = 'checkout-setOrderFormConfiguration';
        return this.http.post(routes.orderFormConfiguration, body, request_1.getRequestConfig(this.context, authMethod, metric, tracingConfig));
    }
    // eslint-disable-next-line max-params
    setSingleCustomData(orderFormId, customData, authMethod = 'AUTH_TOKEN', tracingConfig) {
        const metric = 'checkout-setSingleCustomData';
        const { appId, appFieldName, value } = customData;
        return this.http.put(routes.singleCustomData(orderFormId, appId, appFieldName), { value }, request_1.getRequestConfig(this.context, authMethod, metric, tracingConfig));
    }
    // eslint-disable-next-line max-params
    addItem(orderFormId, items, queryString = '', authMethod = 'STORE_TOKEN', tracingConfig) {
        const metric = 'checkout-addItem';
        return this.http.post(routes.addItem(orderFormId, queryString), { orderItems: items }, request_1.getRequestConfig(this.context, authMethod, metric, tracingConfig));
    }
    // eslint-disable-next-line max-params
    cancelOrder(orderFormId, reason, authMethod = 'STORE_TOKEN', tracingConfig) {
        const metric = 'checkout-cancelOrder';
        return this.http.post(routes.cancelOrder(orderFormId), { reason }, request_1.getRequestConfig(this.context, authMethod, metric, tracingConfig));
    }
    // eslint-disable-next-line max-params
    setOrderFormCustomData(orderFormId, appId, field, value, authMethod = 'STORE_TOKEN', tracingConfig) {
        const metric = 'checkout-setOrderFormCustomData';
        return this.http.put(routes.orderFormCustomData(orderFormId, appId, field), { value }, request_1.getRequestConfig(this.context, authMethod, metric, tracingConfig));
    }
    // eslint-disable-next-line max-params
    updateItems(orderFormId, orderItems, authMethod = 'STORE_TOKEN', tracingConfig) {
        const metric = 'checkout-updateItems';
        return this.http.post(routes.updateItems(orderFormId), { orderItems }, request_1.getRequestConfig(this.context, authMethod, metric, tracingConfig));
    }
    // eslint-disable-next-line max-params
    updateOrderFormPayment(orderFormId, payments, authMethod = 'STORE_TOKEN', tracingConfig) {
        const metric = 'checkout-updateOrderFormPayment';
        return this.http.post(routes.attachmentsData(orderFormId, 'paymentData'), { payments }, request_1.getRequestConfig(this.context, authMethod, metric, tracingConfig));
    }
    // eslint-disable-next-line max-params
    updateOrderFormProfile(orderFormId, fields, authMethod = 'STORE_TOKEN', tracingConfig) {
        const metric = 'checkout-updateOrderFormProfile';
        return this.http.post(routes.attachmentsData(orderFormId, 'clientProfileData'), fields, request_1.getRequestConfig(this.context, authMethod, metric, tracingConfig));
    }
    // eslint-disable-next-line max-params
    updateOrderFormShipping(orderFormId, shippingAddress, authMethod = 'STORE_TOKEN', tracingConfig) {
        const metric = 'checkout-updateOrderFormShipping';
        this.http.post(routes.attachmentsData(orderFormId, 'shippingData'), shippingAddress, request_1.getRequestConfig(this.context, authMethod, metric, tracingConfig));
    }
    // eslint-disable-next-line max-params
    updateOrderFormMarketingData(orderFormId, marketingData, authMethod = 'STORE_TOKEN', tracingConfig) {
        const metric = 'checkout-updateOrderFormMarketingData';
        return this.http.post(routes.attachmentsData(orderFormId, 'marketingData'), marketingData, request_1.getRequestConfig(this.context, authMethod, metric, tracingConfig));
    }
    // eslint-disable-next-line max-params
    updateOrderFormClientPreferencesData(orderFormId, clientPreferencesData, authMethod = 'STORE_TOKEN', tracingConfig) {
        const metric = 'checkout-updateOrderFormClientPreferencesData';
        // The API default value of `optinNewsLetter` is `null`, but it doesn't accept a POST with its value as `null`
        const filteredClientPreferencesData = clientPreferencesData.optinNewsLetter === null
            ? { locale: clientPreferencesData.locale }
            : clientPreferencesData;
        return this.http.post(routes.attachmentsData(orderFormId, 'clientPreferencesData'), filteredClientPreferencesData, request_1.getRequestConfig(this.context, authMethod, metric, tracingConfig));
    }
    // eslint-disable-next-line max-params
    addAssemblyOptions(orderFormId, itemId, assemblyOptionsId, body, authMethod = 'STORE_TOKEN', tracingConfig) {
        const metric = 'checkout-addAssemblyOptions';
        return this.http.post(routes.assemblyOptions(orderFormId, itemId, assemblyOptionsId), body, request_1.getRequestConfig(this.context, authMethod, metric, tracingConfig));
    }
    // eslint-disable-next-line max-params
    async removeAssemblyOptions(orderFormId, itemId, assemblyOptionsId, body, authMethod = 'STORE_TOKEN', tracingConfig) {
        const metric = 'checkout-removeAssemblyOptions';
        return this.http.delete(routes.assemblyOptions(orderFormId, itemId, assemblyOptionsId), {
            ...request_1.getRequestConfig(this.context, authMethod, metric, tracingConfig),
            data: body,
        });
    }
    // eslint-disable-next-line max-params
    updateOrderFormCheckin(orderFormId, checkinPayload, authMethod = 'STORE_TOKEN', tracingConfig) {
        const metric = 'checkout-updateOrderFormCheckin';
        return this.http.post(routes.checkin(orderFormId), checkinPayload, request_1.getRequestConfig(this.context, authMethod, metric, tracingConfig));
    }
    orderForm(orderFormId, authMethod = 'STORE_TOKEN', tracingConfig) {
        const metric = 'checkout-orderForm';
        return this.http.post(routes.orderForm(orderFormId), { expectedOrderFormSections: ['items'] }, request_1.getRequestConfig(this.context, authMethod, metric, tracingConfig));
    }
    orderFormRaw(authMethod = 'STORE_TOKEN', tracingConfig) {
        const metric = 'checkout-orderForm';
        return this.http.post(routes.orderForm(), { expectedOrderFormSections: ['items'] }, request_1.getRequestConfig(this.context, authMethod, metric, tracingConfig));
    }
    newOrderForm(orderFormId, authMethod = 'STORE_TOKEN', tracingConfig) {
        const metric = 'checkout-newOrderForm';
        return this.http.post(routes.orderForm(orderFormId), undefined, request_1.getRequestConfig(this.context, authMethod, metric, tracingConfig));
    }
    orders(authMethod = 'STORE_TOKEN', tracingConfig) {
        const metric = 'checkout-orders';
        return this.http.get(routes.orders, request_1.getRequestConfig(this.context, authMethod, metric, tracingConfig));
    }
    setNewOrder(order, authMethod = 'ADMIN_TOKEN', tracingConfig) {
        const metric = 'checkout-orders';
        return this.http.put(routes.orders, order, request_1.getRequestConfig(this.context, authMethod, metric, tracingConfig));
    }
    // eslint-disable-next-line max-params
    simulation(simulation, authMethod = 'STORE_TOKEN', tracingConfig) {
        const metric = 'checkout-simulation';
        return this.http.post(routes.simulation(), simulation, request_1.getRequestConfig(this.context, authMethod, metric, tracingConfig));
    }
    // eslint-disable-next-line max-params
    clientProfile(email, mket) {
        return this.http.get(routes.clientProfile(email), request_keys_1.getRequestConfigKey(mket));
    }
    // eslint-disable-next-line max-params
    updateOrderFormIgnoreProfile(orderFormId, ignoreProfileData, authMethod = 'STORE_TOKEN', tracingConfig) {
        const metric = 'checkout-updateOrderFormIgnoreProfile';
        return this.http.patch(routes.profile(orderFormId), { ignoreProfileData }, request_1.getRequestConfig(this.context, authMethod, metric, tracingConfig));
    }
}
exports.Checkout = Checkout;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hlY2tvdXQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9zcmMvbm9kZS9jbGllbnRzL2NoZWNrb3V0L2NoZWNrb3V0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUtBLG1DQUF1QztBQUV2Qyw4Q0FBbUQ7QUFDbkQsd0RBQTJEO0FBZTNELE1BQU0sT0FBTyxHQUFHLGVBQWUsQ0FBQTtBQUUvQixNQUFNLE1BQU0sR0FBRztJQUNiLE9BQU8sRUFBRSxDQUFDLFdBQW1CLEVBQUUsV0FBbUIsRUFBRSxFQUFFLENBQ3BELEdBQUcsT0FBTyxrQkFBa0IsV0FBVyxTQUFTLFdBQVcsRUFBRTtJQUMvRCxXQUFXLEVBQUUsQ0FBQyxXQUFtQixFQUFFLEVBQUUsQ0FDbkMsR0FBRyxPQUFPLGVBQWUsV0FBVyxzQkFBc0I7SUFDNUQsbUJBQW1CLEVBQUUsQ0FBQyxXQUFtQixFQUFFLEtBQWEsRUFBRSxLQUFhLEVBQUUsRUFBRSxDQUN6RSxHQUFHLE9BQU8sa0JBQWtCLFdBQVcsZUFBZSxLQUFLLElBQUksS0FBSyxFQUFFO0lBQ3hFLFdBQVcsRUFBRSxDQUFDLFdBQW1CLEVBQUUsRUFBRSxDQUNuQyxHQUFHLE9BQU8sa0JBQWtCLFdBQVcsZUFBZTtJQUN4RCxPQUFPLEVBQUUsQ0FBQyxXQUFtQixFQUFFLEVBQUUsQ0FDL0IsR0FBRyxPQUFPLGtCQUFrQixXQUFXLFVBQVU7SUFDbkQsZUFBZSxFQUFFLENBQUMsV0FBbUIsRUFBRSxLQUFhLEVBQUUsRUFBRSxDQUN0RCxHQUFHLE9BQU8sa0JBQWtCLFdBQVcsZ0JBQWdCLEtBQUssRUFBRTtJQUNoRSxlQUFlLEVBQUUsQ0FDZixXQUFtQixFQUNuQixNQUF1QixFQUN2QixpQkFBeUIsRUFDekIsRUFBRSxDQUNGLEdBQUcsT0FBTyxrQkFBa0IsV0FBVyxVQUFVLE1BQU0sb0JBQW9CLGlCQUFpQixFQUFFO0lBQ2hHLE9BQU8sRUFBRSxDQUFDLFdBQW1CLEVBQUUsRUFBRSxD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LENBQ3BCLE1BQU0sQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLEVBQzNCLEVBQUUsaUJBQWlCLEVBQUUsRUFDckIsMEJBQWdCLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLGFBQWEsQ0FBQyxDQUNsRSxDQUFBO0lBQ0gsQ0FBQztDQUNGO0FBNVdELDRCQTRXQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHtcbiAgSW5zdGFuY2VPcHRpb25zLFxuICBJT0NvbnRleHQsXG4gIFJlcXVlc3RUcmFjaW5nQ29uZmlnLFxufSBmcm9tICdAdnRleC9hcGknXG5pbXBvcnQgeyBKYW51c0NsaWVudCB9IGZyb20gJ0B2dGV4L2FwaSdcblxuaW1wb3J0IHsgZ2V0UmVxdWVzdENvbmZpZyB9IGZyb20gJy4uL3V0aWxzL3JlcXVlc3QnXG5pbXBvcnQgeyBnZXRSZXF1ZXN0Q29uZmlnS2V5IH0gZnJvbSAnLi4vdXRpbHMvcmVxdWVzdF9rZXlzJ1xuaW1wb3J0IHR5cGUge1xuICBPcmRlckZvcm0sXG4gIE9yZGVyRm9ybUNsaWVudFByZWZlcmVuY2VzRGF0YSxcbiAgT3JkZXJGb3JtQ29uZmlndXJhdGlvbixcbiAgU2ltdWxhdGlvbk9yZGVyRm9ybSxcbn0gZnJvbSAnLi4vdHlwaW5ncy9vcmRlckZvcm0nXG5pbXBvcnQgdHlwZSB7XG4gIFNpbXVsYXRpb25QYXlsb2FkLFxuICBTaW5nbGVDdXN0b21EYXRhLFxuICBPcmRlckZvcm1QYXltZW50LFxuICBDaGVja291dEFkZHJlc3MsXG59IGZyb20gJy4uL3R5cGluZ3MvY2hlY2tvdXQnXG5pbXBvcnQgdHlwZSB7IEF1dGhNZXRob2QgfSBmcm9tICcuLi90eXBpbmdzL3Rva2VucydcblxuY29uc3QgYmFzZVVSTCA9ICcvYXBpL2NoZWNrb3V0J1xuXG5jb25zdCByb3V0ZXMgPSB7XG4gIGFkZEl0ZW06IChvcmRlckZvcm1JZDogc3RyaW5nLCBxdWVyeVN0cmluZzogc3RyaW5nKSA9PlxuICAgIGAke2Jhc2VVUkx9L3B1Yi9vcmRlckZvcm0vJHtvcmRlckZvcm1JZH0vaXRlbXMke3F1ZXJ5U3RyaW5nfWAsXG4gIGNhbmNlbE9yZGVyOiAob3JkZXJGb3JtSWQ6IHN0cmluZykgPT5cbiAgICBgJHtiYXNlVVJMfS9wdWIvb3JkZXJzLyR7b3JkZXJGb3JtSWR9L3VzZXItY2FuY2VsLXJlcXVlc3RgLFxuICBvcmRlckZvcm1DdXN0b21EYXRhOiAob3JkZXJGb3JtSWQ6IHN0cmluZywgYXBwSWQ6IHN0cmluZywgZmllbGQ6IHN0cmluZykgPT5cbiAgICBgJHtiYXNlVVJMfS9wdWIvb3JkZXJGb3JtLyR7b3JkZXJGb3JtSWR9L2N1c3RvbURhdGEvJHthcHBJZH0vJHtmaWVsZH1gLFxuICB1cGRhdGVJdGVtczogKG9yZGVyRm9ybUlkOiBzdHJpbmcpID0+XG4gICAgYCR7YmFzZVVSTH0vcHViL29yZGVyRm9ybS8ke29yZGVyRm9ybUlkfS9pdGVtcy91cGRhdGVgLFxuICBwcm9maWxlOiAob3JkZXJGb3JtSWQ6IHN0cmluZykgPT5cbiAgICBgJHtiYXNlVVJMfS9wdWIvb3JkZXJGb3JtLyR7b3JkZXJGb3JtSWR9L3Byb2ZpbGVgLFxuICBhdHRhY2htZW50c0RhdGE6IChvcmRlckZvcm1JZDogc3RyaW5nLCBmaWVsZDogc3RyaW5nKSA9PlxuICAgIGAke2Jhc2VVUkx9L3B1Yi9vcmRlckZvcm0vJHtvcmRlckZvcm1JZH0vYXR0YWNobWVudHMvJHtmaWVsZH1gLFxuICBhc3NlbWJseU9wdGlvbnM6IChcbiAgICBvcmRlckZvcm1JZDogc3RyaW5nLFxuICAgIGl0ZW1JZDogc3RyaW5nIHwgbnVtYmVyLFxuICAgIGFzc2VtYmx5T3B0aW9uc0lkOiBzdHJpbmdcbiAgKSA9PlxuICAgIGAke2Jhc2VVUkx9L3B1Yi9vcmRlckZvcm0vJHtvcmRlckZvcm1JZH0vaXRlbXMvJHtpdGVtSWR9L2Fzc2VtYmx5T3B0aW9ucy8ke2Fzc2VtYmx5T3B0aW9uc0lkfWAsXG4gIGNoZWNraW46IChvcmRlckZvcm1JZDogc3RyaW5nKSA9PlxuICAgIGAke2Jhc2VVUkx9L3B1Yi9vcmRlckZvcm0vJHtvcmRlckZvcm1JZH0vY2hlY2tJbmAsXG4gIG9yZGVyRm9ybTogKG9yZGVyRm9ybUlkPzogc3RyaW5nKSA9PlxuICAgIGAke2Jhc2VVUkx9L3B1Yi9vcmRlckZvcm0vJHtvcmRlckZvcm1JZCA/PyAnJ31gLFxuICBvcmRlcnM6IGAke2Jhc2VVUkx9L3B1Yi9vcmRlcnNgLFxuICBzaW11bGF0aW9uOiAoKSA9PiBgJHtiYXNlVVJMfS9wdWIvb3JkZXJGb3Jtcy9zaW11bGF0aW9uYCxcbiAgY2hhbmdlVG9Bbm9ueW1vdXNVc2VyOiAob3JkZXJGb3JtSWQ6IHN0cmluZykgPT5cbiAgICBgL2NoZWNrb3V0L2NoYW5nZVRvQW5vbnltb3VzVXNlci8ke29yZGVyRm9ybUlkfWAsXG4gIG9yZGVyRm9ybUNvbmZpZ3VyYXRpb246IGAke2Jhc2VVUkx9L3B2dC9jb25maWd1cmF0aW9uL29yZGVyRm9ybWAsXG4gIHNpbmdsZUN1c3RvbURhdGE6IChcbiAgICBvcmRlckZvcm1JZDogc3RyaW5nLFxuICAgIGFwcElkOiBzdHJpbmcsXG4gICAgYXBwRmllbGROYW1lOiBzdHJpbmdcbiAgKSA9PlxuICAgIGAke2Jhc2VVUkx9L3B1Yi9vcmRlckZvcm0vJHtvcmRlckZvcm1JZH0vY3VzdG9tRGF0YS8ke2FwcElkfS8ke2FwcEZpZWxkTmFtZX1gLFxuICBjbGllbnRQcm9maWxlOiAoZW1haWw6IHN0cmluZykgPT4gYGh0dHA6Ly9wb3J0YWwudnRleGNvbW1lcmNlc3RhYmxlLmNvbS5iciR7YmFzZVVSTH0vcHViL3Byb2ZpbGVzP2VtYWlsPSR7ZW1haWx9YCxcbiAgY3JlYXRlVHJhbnNhY3Rpb246IChhY2NvdW50OiBzdHJpbmcsIHRyYW5zYWN0aW9uSWQ6IHN0cmluZykgPT5cbiAgICBgaHR0cHM6Ly8ke2FjY291bnR9LnZ0ZXhwYXltZW50cy5jb20uYnIvYXBpL3B2dC90cmFuc2FjdGlvbnMvJHt0cmFuc2FjdGlvbklkfS9wYXltZW50c2AsXG59XG5cbmV4cG9ydCBjbGFzcyBDaGVja291dCBleHRlbmRzIEphbnVzQ2xpZW50IHtcbiAgY29uc3RydWN0b3IoY3R4OiBJT0NvbnRleHQsIG9wdGlvbnM/OiBJbnN0YW5jZU9wdGlvbnMpIHtcbiAgICBzdXBlcihjdHgsIHtcbiAgICAgIC4uLm9wdGlvbnMsXG4gICAgfSlcbiAgfVxuXG4gIHB1YmxpYyBnZXRPcmRlckZvcm1Db25maWd1cmF0aW9uKFxuICAgIGF1dGhNZXRob2Q6IEF1dGhNZXRob2QgPSAnQVVUSF9UT0tFTicsXG4gICAgdHJhY2luZ0NvbmZpZz86IFJlcXVlc3RUcmFjaW5nQ29uZmlnXG4gICkge1xuICAgIGNvbnN0IG1ldHJpYyA9ICdjaGVja291dC1nZXRPcmRlckZvcm1Db25maWd1cmF0aW9uJ1xuXG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQ8T3JkZXJGb3JtQ29uZmlndXJhdGlvbj4oXG4gICAgICByb3V0ZXMub3JkZXJGb3JtQ29uZmlndXJhdGlvbixcbiAgICAgIGdldFJlcXVlc3RDb25maWcodGhpcy5jb250ZXh0LCBhdXRoTWV0aG9kLCBtZXRyaWMsIHRyYWNpbmdDb25maWcpXG4gICAgKVxuICB9XG5cbiAgcHVibGljIHNldE9yZGVyRm9ybUNvbmZpZ3VyYXRpb24oXG4gICAgYm9keTogT3JkZXJGb3JtQ29uZmlndXJhdGlvbixcbiAgICBhdXRoTWV0aG9kOiBBdXRoTWV0aG9kID0gJ0FVVEhfVE9LRU4nLFxuICAgIHRyYWNpbmdDb25maWc/OiBSZXF1ZXN0VHJhY2luZ0NvbmZpZ1xuICApIHtcbiAgICBjb25zdCBtZXRyaWMgPSAnY2hlY2tvdXQtc2V0T3JkZXJGb3JtQ29uZmlndXJhdGlvbidcblxuICAgIHJldHVybiB0aGlzLmh0dHAucG9zdChcbiAgICAgIHJvdXRlcy5vcmRlckZvcm1Db25maWd1cmF0aW9uLFxuICAgICAgYm9keSxcbiAgICAgIGdldFJlcXVlc3RDb25maWcodGhpcy5jb250ZXh0LCBhdXRoTWV0aG9kLCBtZXRyaWMsIHRyYWNpbmdDb25maWcpXG4gICAgKVxuICB9XG5cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG1heC1wYXJhbXNcbiAgcHVibGljIHNldFNpbmdsZUN1c3RvbURhdGEoXG4gICAgb3JkZXJGb3JtSWQ6IHN0cmluZyxcbiAgICBjdXN0b21EYXRhOiBTaW5nbGVDdXN0b21EYXRhLFxuICAgIGF1dGhNZXRob2Q6IEF1dGhNZXRob2QgPSAnQVVUSF9UT0tFTicsXG4gICAgdHJhY2luZ0NvbmZpZz86IFJlcXVlc3RUcmFjaW5nQ29uZmlnXG4gICkge1xuICAgIGNvbnN0IG1ldHJpYyA9ICdjaGVja291dC1zZXRTaW5nbGVDdXN0b21EYXRhJ1xuXG4gICAgY29uc3QgeyBhcHBJZCwgYXBwRmllbGROYW1lLCB2YWx1ZSB9ID0gY3VzdG9tRGF0YVxuXG4gICAgcmV0dXJuIHRoaXMuaHR0cC5wdXQoXG4gICAgICByb3V0ZXMuc2luZ2xlQ3VzdG9tRGF0YShvcmRlckZvcm1JZCwgYXBwSWQsIGFwcEZpZWxkTmFtZSksXG4gICAgICB7IHZhbHVlIH0sXG4gICAgICBnZXRSZXF1ZXN0Q29uZmlnKHRoaXMuY29udGV4dCwgYXV0aE1ldGhvZCwgbWV0cmljLCB0cmFjaW5nQ29uZmlnKVxuICAgIClcbiAgfVxuXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBtYXgtcGFyYW1zXG4gIHB1YmxpYyBhZGRJdGVtKFxuICAgIG9yZGVyRm9ybUlkOiBzdHJpbmcsXG4gICAgaXRlbXM6IGFueSxcbiAgICBxdWVyeVN0cmluZyA9ICcnLFxuICAgIGF1dGhNZXRob2Q6IEF1dGhNZXRob2QgPSAnU1RPUkVfVE9LRU4nLFxuICAgIHRyYWNpbmdDb25maWc/OiBSZXF1ZXN0VHJhY2luZ0NvbmZpZ1xuICApIHtcbiAgICBjb25zdCBtZXRyaWMgPSAnY2hlY2tvdXQtYWRkSXRlbSdcblxuICAgIHJldHVybiB0aGlzLmh0dHAucG9zdDxPcmRlckZvcm0+KFxuICAgICAgcm91dGVzLmFkZEl0ZW0ob3JkZXJGb3JtSWQsIHF1ZXJ5U3RyaW5nKSxcbiAgICAgIHsgb3JkZXJJdGVtczogaXRlbXMgfSxcbiAgICAgIGdldFJlcXVlc3RDb25maWcodGhpcy5jb250ZXh0LCBhdXRoTWV0aG9kLCBtZXRyaWMsIHRyYWNpbmdDb25maWcpXG4gICAgKVxuICB9XG5cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG1heC1wYXJhbXNcbiAgcHVibGljIGNhbmNlbE9yZGVyKFxuICAgIG9yZGVyRm9ybUlkOiBzdHJpbmcsXG4gICAgcmVhc29uOiBzdHJpbmcsXG4gICAgYXV0aE1ldGhvZDogQXV0aE1ldGhvZCA9ICdTVE9SRV9UT0tFTicsXG4gICAgdHJhY2luZ0NvbmZpZz86IFJlcXVlc3RUcmFjaW5nQ29uZmlnXG4gICkge1xuICAgIGNvbnN0IG1ldHJpYyA9ICdjaGVja291dC1jYW5jZWxPcmRlcidcblxuICAgIHJldHVybiB0aGlzLmh0dHAucG9zdChcbiAgICAgIHJvdXRlcy5jYW5jZWxPcmRlcihvcmRlckZvcm1JZCksXG4gICAgICB7IHJlYXNvbiB9LFxuICAgICAgZ2V0UmVxdWVzdENvbmZpZyh0aGlzLmNvbnRleHQsIGF1dGhNZXRob2QsIG1ldHJpYywgdHJhY2luZ0NvbmZpZylcbiAgICApXG4gIH1cblxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LXBhcmFtc1xuICBwdWJsaWMgc2V0T3JkZXJGb3JtQ3VzdG9tRGF0YShcbiAgICBvcmRlckZvcm1JZDogc3RyaW5nLFxuICAgIGFwcElkOiBzdHJpbmcsXG4gICAgZmllbGQ6IHN0cmluZyxcbiAgICB2YWx1ZTogYW55LFxuICAgIGF1dGhNZXRob2Q6IEF1dGhNZXRob2QgPSAnU1RPUkVfVE9LRU4nLFxuICAgIHRyYWNpbmdDb25maWc/OiBSZXF1ZXN0VHJhY2luZ0NvbmZpZ1xuICApIHtcbiAgICBjb25zdCBtZXRyaWMgPSAnY2hlY2tvdXQtc2V0T3JkZXJGb3JtQ3VzdG9tRGF0YSdcblxuICAgIHJldHVybiB0aGlzLmh0dHAucHV0KFxuICAgICAgcm91dGVzLm9yZGVyRm9ybUN1c3RvbURhdGEob3JkZXJGb3JtSWQsIGFwcElkLCBmaWVsZCksXG4gICAgICB7IHZhbHVlIH0sXG4gICAgICBnZXRSZXF1ZXN0Q29uZmlnKHRoaXMuY29udGV4dCwgYXV0aE1ldGhvZCwgbWV0cmljLCB0cmFjaW5nQ29uZmlnKVxuICAgIClcbiAgfVxuXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBtYXgtcGFyYW1zXG4gIHB1YmxpYyB1cGRhdGVJdGVtcyhcbiAgICBvcmRlckZvcm1JZDogc3RyaW5nLFxuICAgIG9yZGVySXRlbXM6IGFueSxcbiAgICBhdXRoTWV0aG9kOiBBdXRoTWV0aG9kID0gJ1NUT1JFX1RPS0VOJyxcbiAgICB0cmFjaW5nQ29uZmlnPzogUmVxdWVzdFRyYWNpbmdDb25maWdcbiAgKSB7XG4gICAgY29uc3QgbWV0cmljID0gJ2NoZWNrb3V0LXVwZGF0ZUl0ZW1zJ1xuXG4gICAgcmV0dXJuIHRoaXMuaHR0cC5wb3N0KFxuICAgICAgcm91dGVzLnVwZGF0ZUl0ZW1zKG9yZGVyRm9ybUlkKSxcbiAgICAgIHsgb3JkZXJJdGVtcyB9LFxuICAgICAgZ2V0UmVxdWVzdENvbmZpZyh0aGlzLmNvbnRleHQsIGF1dGhNZXRob2QsIG1ldHJpYywgdHJhY2luZ0NvbmZpZylcbiAgICApXG4gIH1cblxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LXBhcmFtc1xuICBwdWJsaWMgdXBkYXRlT3JkZXJGb3JtUGF5bWVudChcbiAgICBvcmRlckZvcm1JZDogc3RyaW5nLFxuICAgIHBheW1lbnRzOiBPcmRlckZvcm1QYXltZW50W10sXG4gICAgYXV0aE1ldGhvZDogQXV0aE1ldGhvZCA9ICdTVE9SRV9UT0tFTicsXG4gICAgdHJhY2luZ0NvbmZpZz86IFJlcXVlc3RUcmFjaW5nQ29uZmlnXG4gICkge1xuICAgIGNvbnN0IG1ldHJpYyA9ICdjaGVja291dC11cGRhdGVPcmRlckZvcm1QYXltZW50J1xuXG4gICAgcmV0dXJuIHRoaXMuaHR0cC5wb3N0KFxuICAgICAgcm91dGVzLmF0dGFjaG1lbnRzRGF0YShvcmRlckZvcm1JZCwgJ3BheW1lbnREYXRhJyksXG4gICAgICB7IHBheW1lbnRzIH0sXG4gICAgICBnZXRSZXF1ZXN0Q29uZmlnKHRoaXMuY29udGV4dCwgYXV0aE1ldGhvZCwgbWV0cmljLCB0cmFjaW5nQ29uZmlnKVxuICAgIClcbiAgfVxuXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBtYXgtcGFyYW1zXG4gIHB1YmxpYyB1cGRhdGVPcmRlckZvcm1Qcm9maWxlKFxuICAgIG9yZGVyRm9ybUlkOiBzdHJpbmcsXG4gICAgZmllbGRzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmcgfCBib29sZWFuPixcbiAgICBhdXRoTWV0aG9kOiBBdXRoTWV0aG9kID0gJ1NUT1JFX1RPS0VOJyxcbiAgICB0cmFjaW5nQ29uZmlnPzogUmVxdWVzdFRyYWNpbmdDb25maWdcbiAgKSB7XG4gICAgY29uc3QgbWV0cmljID0gJ2NoZWNrb3V0LXVwZGF0ZU9yZGVyRm9ybVByb2ZpbGUnXG5cbiAgICByZXR1cm4gdGhpcy5odHRwLnBvc3QoXG4gICAgICByb3V0ZXMuYXR0YWNobWVudHNEYXRhKG9yZGVyRm9ybUlkLCAnY2xpZW50UHJvZmlsZURhdGEnKSxcbiAgICAgIGZpZWxkcyxcbiAgICAgIGdldFJlcXVlc3RDb25maWcodGhpcy5jb250ZXh0LCBhdXRoTWV0aG9kLCBtZXRyaWMsIHRyYWNpbmdDb25maWcpXG4gICAgKVxuICB9XG5cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG1heC1wYXJhbXNcbiAgcHVibGljIHVwZGF0ZU9yZGVyRm9ybVNoaXBwaW5nKFxuICAgIG9yZGVyRm9ybUlkOiBzdHJpbmcsXG4gICAgc2hpcHBpbmdBZGRyZXNzOiBDaGVja291dEFkZHJlc3MsXG4gICAgYXV0aE1ldGhvZDogQXV0aE1ldGhvZCA9ICdTVE9SRV9UT0tFTicsXG4gICAgdHJhY2luZ0NvbmZpZz86IFJlcXVlc3RUcmFjaW5nQ29uZmlnXG4gICkge1xuICAgIGNvbnN0IG1ldHJpYyA9ICdjaGVja291dC11cGRhdGVPcmRlckZvcm1TaGlwcGluZydcblxuICAgIHRoaXMuaHR0cC5wb3N0KFxuICAgICAgcm91dGVzLmF0dGFjaG1lbnRzRGF0YShvcmRlckZvcm1JZCwgJ3NoaXBwaW5nRGF0YScpLFxuICAgICAgc2hpcHBpbmdBZGRyZXNzLFxuICAgICAgZ2V0UmVxdWVzdENvbmZpZyh0aGlzLmNvbnRleHQsIGF1dGhNZXRob2QsIG1ldHJpYywgdHJhY2luZ0NvbmZpZylcbiAgICApXG4gIH1cblxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LXBhcmFtc1xuICBwdWJsaWMgdXBkYXRlT3JkZXJGb3JtTWFya2V0aW5nRGF0YShcbiAgICBvcmRlckZvcm1JZDogc3RyaW5nLFxuICAgIG1hcmtldGluZ0RhdGE6IGFueSxcbiAgICBhdXRoTWV0aG9kOiBBdXRoTWV0aG9kID0gJ1NUT1JFX1RPS0VOJyxcbiAgICB0cmFjaW5nQ29uZmlnPzogUmVxdWVzdFRyYWNpbmdDb25maWdcbiAgKSB7XG4gICAgY29uc3QgbWV0cmljID0gJ2NoZWNrb3V0LXVwZGF0ZU9yZGVyRm9ybU1hcmtldGluZ0RhdGEnXG5cbiAgICByZXR1cm4gdGhpcy5odHRwLnBvc3QoXG4gICAgICByb3V0ZXMuYXR0YWNobWVudHNEYXRhKG9yZGVyRm9ybUlkLCAnbWFya2V0aW5nRGF0YScpLFxuICAgICAgbWFya2V0aW5nRGF0YSxcbiAgICAgIGdldFJlcXVlc3RDb25maWcodGhpcy5jb250ZXh0LCBhdXRoTWV0aG9kLCBtZXRyaWMsIHRyYWNpbmdDb25maWcpXG4gICAgKVxuICB9XG5cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG1heC1wYXJhbXNcbiAgcHVibGljIHVwZGF0ZU9yZGVyRm9ybUNsaWVudFByZWZlcmVuY2VzRGF0YShcbiAgICBvcmRlckZvcm1JZDogc3RyaW5nLFxuICAgIGNsaWVudFByZWZlcmVuY2VzRGF0YTogT3JkZXJGb3JtQ2xpZW50UHJlZmVyZW5jZXNEYXRhLFxuICAgIGF1dGhNZXRob2Q6IEF1dGhNZXRob2QgPSAnU1RPUkVfVE9LRU4nLFxuICAgIHRyYWNpbmdDb25maWc/OiBSZXF1ZXN0VHJhY2luZ0NvbmZpZ1xuICApIHtcbiAgICBjb25zdCBtZXRyaWMgPSAnY2hlY2tvdXQtdXBkYXRlT3JkZXJGb3JtQ2xpZW50UHJlZmVyZW5jZXNEYXRhJ1xuICAgIC8vIFRoZSBBUEkgZGVmYXVsdCB2YWx1ZSBvZiBgb3B0aW5OZXdzTGV0dGVyYCBpcyBgbnVsbGAsIGJ1dCBpdCBkb2Vzbid0IGFjY2VwdCBhIFBPU1Qgd2l0aCBpdHMgdmFsdWUgYXMgYG51bGxgXG4gICAgY29uc3QgZmlsdGVyZWRDbGllbnRQcmVmZXJlbmNlc0RhdGEgPVxuICAgICAgY2xpZW50UHJlZmVyZW5jZXNEYXRhLm9wdGluTmV3c0xldHRlciA9PT0gbnVsbFxuICAgICAgICA/IHsgbG9jYWxlOiBjbGllbnRQcmVmZXJlbmNlc0RhdGEubG9jYWxlIH1cbiAgICAgICAgOiBjbGllbnRQcmVmZXJlbmNlc0RhdGFcblxuICAgIHJldHVybiB0aGlzLmh0dHAucG9zdChcbiAgICAgIHJvdXRlcy5hdHRhY2htZW50c0RhdGEob3JkZXJGb3JtSWQsICdjbGllbnRQcmVmZXJlbmNlc0RhdGEnKSxcbiAgICAgIGZpbHRlcmVkQ2xpZW50UHJlZmVyZW5jZXNEYXRhLFxuICAgICAgZ2V0UmVxdWVzdENvbmZpZyh0aGlzLmNvbnRleHQsIGF1dGhNZXRob2QsIG1ldHJpYywgdHJhY2luZ0NvbmZpZylcbiAgICApXG4gIH1cblxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LXBhcmFtc1xuICBwdWJsaWMgYWRkQXNzZW1ibHlPcHRpb25zKFxuICAgIG9yZGVyRm9ybUlkOiBzdHJpbmcsXG4gICAgaXRlbUlkOiBzdHJpbmcgfCBudW1iZXIsXG4gICAgYXNzZW1ibHlPcHRpb25zSWQ6IHN0cmluZyxcbiAgICBib2R5OiBhbnksXG4gICAgYXV0aE1ldGhvZDogQXV0aE1ldGhvZCA9ICdTVE9SRV9UT0tFTicsXG4gICAgdHJhY2luZ0NvbmZpZz86IFJlcXVlc3RUcmFjaW5nQ29uZmlnXG4gICkge1xuICAgIGNvbnN0IG1ldHJpYyA9ICdjaGVja291dC1hZGRBc3NlbWJseU9wdGlvbnMnXG5cbiAgICByZXR1cm4gdGhpcy5odHRwLnBvc3Q8T3JkZXJGb3JtPihcbiAgICAgIHJvdXRlcy5hc3NlbWJseU9wdGlvbnMob3JkZXJGb3JtSWQsIGl0ZW1JZCwgYXNzZW1ibHlPcHRpb25zSWQpLFxuICAgICAgYm9keSxcbiAgICAgIGdldFJlcXVlc3RDb25maWcodGhpcy5jb250ZXh0LCBhdXRoTWV0aG9kLCBtZXRyaWMsIHRyYWNpbmdDb25maWcpXG4gICAgKVxuICB9XG5cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG1heC1wYXJhbXNcbiAgcHVibGljIGFzeW5jIHJlbW92ZUFzc2VtYmx5T3B0aW9ucyhcbiAgICBvcmRlckZvcm1JZDogc3RyaW5nLFxuICAgIGl0ZW1JZDogc3RyaW5nIHwgbnVtYmVyLFxuICAgIGFzc2VtYmx5T3B0aW9uc0lkOiBzdHJpbmcsXG4gICAgYm9keTogYW55LFxuICAgIGF1dGhNZXRob2Q6IEF1dGhNZXRob2QgPSAnU1RPUkVfVE9LRU4nLFxuICAgIHRyYWNpbmdDb25maWc/OiBSZXF1ZXN0VHJhY2luZ0NvbmZpZ1xuICApIHtcbiAgICBjb25zdCBtZXRyaWMgPSAnY2hlY2tvdXQtcmVtb3ZlQXNzZW1ibHlPcHRpb25zJ1xuXG4gICAgcmV0dXJuIHRoaXMuaHR0cC5kZWxldGU8T3JkZXJGb3JtPihcbiAgICAgIHJvdXRlcy5hc3NlbWJseU9wdGlvbnMob3JkZXJGb3JtSWQsIGl0ZW1JZCwgYXNzZW1ibHlPcHRpb25zSWQpLFxuICAgICAge1xuICAgICAgICAuLi5nZXRSZXF1ZXN0Q29uZmlnKHRoaXMuY29udGV4dCwgYXV0aE1ldGhvZCwgbWV0cmljLCB0cmFjaW5nQ29uZmlnKSxcbiAgICAgICAgZGF0YTogYm9keSxcbiAgICAgIH1cbiAgICApXG4gIH1cblxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LXBhcmFtc1xuICBwdWJsaWMgdXBkYXRlT3JkZXJGb3JtQ2hlY2tpbihcbiAgICBvcmRlckZvcm1JZDogc3RyaW5nLFxuICAgIGNoZWNraW5QYXlsb2FkOiBhbnksXG4gICAgYXV0aE1ldGhvZDogQXV0aE1ldGhvZCA9ICdTVE9SRV9UT0tFTicsXG4gICAgdHJhY2luZ0NvbmZpZz86IFJlcXVlc3RUcmFjaW5nQ29uZmlnXG4gICkge1xuICAgIGNvbnN0IG1ldHJpYyA9ICdjaGVja291dC11cGRhdGVPcmRlckZvcm1DaGVja2luJ1xuXG4gICAgcmV0dXJuIHRoaXMuaHR0cC5wb3N0KFxuICAgICAgcm91dGVzLmNoZWNraW4ob3JkZXJGb3JtSWQpLFxuICAgICAgY2hlY2tpblBheWxvYWQsXG4gICAgICBnZXRSZXF1ZXN0Q29uZmlnKHRoaXMuY29udGV4dCwgYXV0aE1ldGhvZCwgbWV0cmljLCB0cmFjaW5nQ29uZmlnKVxuICAgIClcbiAgfVxuXG4gIHB1YmxpYyBvcmRlckZvcm0oXG4gICAgb3JkZXJGb3JtSWQ/OiBzdHJpbmcsXG4gICAgYXV0aE1ldGhvZDogQXV0aE1ldGhvZCA9ICdTVE9SRV9UT0tFTicsXG4gICAgdHJhY2luZ0NvbmZpZz86IFJlcXVlc3RUcmFjaW5nQ29uZmlnXG4gICkge1xuICAgIGNvbnN0IG1ldHJpYyA9ICdjaGVja291dC1vcmRlckZvcm0nXG5cbiAgICByZXR1cm4gdGhpcy5odHRwLnBvc3Q8T3JkZXJGb3JtPihcbiAgICAgIHJvdXRlcy5vcmRlckZvcm0ob3JkZXJGb3JtSWQpLFxuICAgICAgeyBleHBlY3RlZE9yZGVyRm9ybVNlY3Rpb25zOiBbJ2l0ZW1zJ10gfSxcbiAgICAgIGdldFJlcXVlc3RDb25maWcodGhpcy5jb250ZXh0LCBhdXRoTWV0aG9kLCBtZXRyaWMsIHRyYWNpbmdDb25maWcpXG4gICAgKVxuICB9XG5cbiAgcHVibGljIG9yZGVyRm9ybVJhdyhcbiAgICBhdXRoTWV0aG9kOiBBdXRoTWV0aG9kID0gJ1NUT1JFX1RPS0VOJyxcbiAgICB0cmFjaW5nQ29uZmlnPzogUmVxdWVzdFRyYWNpbmdDb25maWdcbiAgKSB7XG4gICAgY29uc3QgbWV0cmljID0gJ2NoZWNrb3V0LW9yZGVyRm9ybSdcblxuICAgIHJldHVybiB0aGlzLmh0dHAucG9zdDxPcmRlckZvcm0+KFxuICAgICAgcm91dGVzLm9yZGVyRm9ybSgpLFxuICAgICAgeyBleHBlY3RlZE9yZGVyRm9ybVNlY3Rpb25zOiBbJ2l0ZW1zJ10gfSxcbiAgICAgIGdldFJlcXVlc3RDb25maWcodGhpcy5jb250ZXh0LCBhdXRoTWV0aG9kLCBtZXRyaWMsIHRyYWNpbmdDb25maWcpXG4gICAgKVxuICB9XG5cbiAgcHVibGljIG5ld09yZGVyRm9ybShcbiAgICBvcmRlckZvcm1JZD86IHN0cmluZyxcbiAgICBhdXRoTWV0aG9kOiBBdXRoTWV0aG9kID0gJ1NUT1JFX1RPS0VOJyxcbiAgICB0cmFjaW5nQ29uZmlnPzogUmVxdWVzdFRyYWNpbmdDb25maWdcbiAgKSB7XG4gICAgY29uc3QgbWV0cmljID0gJ2NoZWNrb3V0LW5ld09yZGVyRm9ybSdcblxuICAgIHJldHVybiB0aGlzLmh0dHAucG9zdChcbiAgICAgIHJvdXRlcy5vcmRlckZvcm0ob3JkZXJGb3JtSWQpLFxuICAgICAgdW5kZWZpbmVkLFxuICAgICAgZ2V0UmVxdWVzdENvbmZpZyh0aGlzLmNvbnRleHQsIGF1dGhNZXRob2QsIG1ldHJpYywgdHJhY2luZ0NvbmZpZylcbiAgICApXG4gIH1cblxuICBwdWJsaWMgb3JkZXJzKFxuICAgIGF1dGhNZXRob2Q6IEF1dGhNZXRob2QgPSAnU1RPUkVfVE9LRU4nLFxuICAgIHRyYWNpbmdDb25maWc/OiBSZXF1ZXN0VHJhY2luZ0NvbmZpZ1xuICApIHtcbiAgICBjb25zdCBtZXRyaWMgPSAnY2hlY2tvdXQtb3JkZXJzJ1xuXG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQoXG4gICAgICByb3V0ZXMub3JkZXJzLFxuICAgICAgZ2V0UmVxdWVzdENvbmZpZyh0aGlzLmNvbnRleHQsIGF1dGhNZXRob2QsIG1ldHJpYywgdHJhY2luZ0NvbmZpZylcbiAgICApXG4gIH1cblxuICBwdWJsaWMgc2V0TmV3T3JkZXIoXG4gICAgb3JkZXI6IGFueSxcbiAgICBhdXRoTWV0aG9kOiBBdXRoTWV0aG9kID0gJ0FETUlOX1RPS0VOJyxcbiAgICB0cmFjaW5nQ29uZmlnPzogUmVxdWVzdFRyYWNpbmdDb25maWdcbiAgKSB7XG4gICAgY29uc3QgbWV0cmljID0gJ2NoZWNrb3V0LW9yZGVycydcbiAgICByZXR1cm4gdGhpcy5odHRwLnB1dChcbiAgICAgIHJvdXRlcy5vcmRlcnMsXG4gICAgICBvcmRlcixcbiAgICAgIGdldFJlcXVlc3RDb25maWcodGhpcy5jb250ZXh0LCBhdXRoTWV0aG9kLCBtZXRyaWMsIHRyYWNpbmdDb25maWcpXG4gICAgKVxuICB9XG5cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG1heC1wYXJhbXNcbiAgcHVibGljIHNpbXVsYXRpb24oXG4gICAgc2ltdWxhdGlvbjogU2ltdWxhdGlvblBheWxvYWQsXG4gICAgYXV0aE1ldGhvZDogQXV0aE1ldGhvZCA9ICdTVE9SRV9UT0tFTicsXG4gICAgdHJhY2luZ0NvbmZpZz86IFJlcXVlc3RUcmFjaW5nQ29uZmlnXG4gICkge1xuICAgIGNvbnN0IG1ldHJpYyA9ICdjaGVja291dC1zaW11bGF0aW9uJ1xuXG4gICAgcmV0dXJuIHRoaXMuaHR0cC5wb3N0PFNpbXVsYXRpb25PcmRlckZvcm0+KFxuICAgICAgcm91dGVzLnNpbXVsYXRpb24oKSxcbiAgICAgIHNpbXVsYXRpb24sXG4gICAgICBnZXRSZXF1ZXN0Q29uZmlnKHRoaXMuY29udGV4dCwgYXV0aE1ldGhvZCwgbWV0cmljLCB0cmFjaW5nQ29uZmlnKVxuICAgIClcbiAgfVxuXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBtYXgtcGFyYW1zXG4gIHB1YmxpYyBjbGllbnRQcm9maWxlKFxuICAgIGVtYWlsOiBzdHJpbmcsXG4gICAgbWtldDpzdHJpbmdcbiAgKSB7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQoXG4gICAgICByb3V0ZXMuY2xpZW50UHJvZmlsZShlbWFpbCksXG4gICAgICBnZXRSZXF1ZXN0Q29uZmlnS2V5KG1rZXQpXG4gICAgKVxuICB9XG5cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG1heC1wYXJhbXNcbiAgcHVibGljIHVwZGF0ZU9yZGVyRm9ybUlnbm9yZVByb2ZpbGUoXG4gICAgb3JkZXJGb3JtSWQ6IHN0cmluZyxcbiAgICBpZ25vcmVQcm9maWxlRGF0YTogYm9vbGVhbixcbiAgICBhdXRoTWV0aG9kOiBBdXRoTWV0aG9kID0gJ1NUT1JFX1RPS0VOJyxcbiAgICB0cmFjaW5nQ29uZmlnPzogUmVxdWVzdFRyYWNpbmdDb25maWdcbiAgKSB7XG4gICAgY29uc3QgbWV0cmljID0gJ2NoZWNrb3V0LXVwZGF0ZU9yZGVyRm9ybUlnbm9yZVByb2ZpbGUnXG5cbiAgICByZXR1cm4gdGhpcy5odHRwLnBhdGNoKFxuICAgICAgcm91dGVzLnByb2ZpbGUob3JkZXJGb3JtSWQpLFxuICAgICAgeyBpZ25vcmVQcm9maWxlRGF0YSB9LFxuICAgICAgZ2V0UmVxdWVzdENvbmZpZyh0aGlzLmNvbnRleHQsIGF1dGhNZXRob2QsIG1ldHJpYywgdHJhY2luZ0NvbmZpZylcbiAgICApXG4gIH1cbn1cbiJdfQ==