"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.VBaseClient = void 0;
const api_1 = require("@vtex/api");
const FIVE_SECONDS_MS = 5 * 1000;
class VBaseClient extends api_1.JanusClient {
    constructor(context, options) {
        super(context, {
            ...options,
            headers: {
                ...(options && options.headers),
                VtexIdClientAutCookie: context.authToken
            },
            timeout: FIVE_SECONDS_MS,
        });
        this.getSecret = (fileName) => {
            const service = process.env.VTEX_APP_NAME;
            const client = new api_1.VBase(this.context);
            return client.getFile(service, fileName);
        };
        this.saveFile = (fileName, data) => {
            const service = process.env.VTEX_APP_NAME;
            const client = new api_1.VBase(this.context);
            const Readable = require('stream').Readable;
            const s = new Readable();
            s._read = () => undefined;
            s.push(JSON.stringify(data));
            s.push(null);
            return client.saveFile(service, fileName, s, false);
        };
    }
}
exports.VBaseClient = VBaseClient;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmJhc2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9zcmMvbm9kZS9jbGllbnRzL3ZiYXNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLG1DQUF3RTtBQUV4RSxNQUFNLGVBQWUsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFBO0FBRWhDLE1BQWEsV0FBWSxTQUFRLGlCQUFXO0lBQ3hDLFlBQW1CLE9BQWtCLEVBQUUsT0FBeUI7UUFDNUQsS0FBSyxDQUFDLE9BQU8sRUFBRTtZQUNYLEdBQUcsT0FBTztZQUNWLE9BQU8sRUFBRTtnQkFDTCxHQUFHLENBQUMsT0FBTyxJQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUM7Z0JBQy9CLHFCQUFxQixFQUFFLE9BQU8sQ0FBQyxTQUFTO2FBQzNDO1lBQ0QsT0FBTyxFQUFFLGVBQWU7U0FDM0IsQ0FBQyxDQUFBO1FBR0MsY0FBUyxHQUFHLENBQUMsUUFBYSxFQUFFLEVBQUU7WUFDakMsTUFBTSxPQUFPLEdBQVEsT0FBTyxDQUFDLEdBQUcsQ0FBQyxhQUFhLENBQUE7WUFFOUMsTUFBTSxNQUFNLEdBQUcsSUFBSSxXQUFLLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFBO1lBRXRDLE9BQU8sTUFBTSxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsUUFBUSxDQUFDLENBQUE7UUFDNUMsQ0FBQyxDQUFBO1FBRU0sYUFBUSxHQUFHLENBQUMsUUFBZ0IsRUFBRSxJQUFTLEVBQUUsRUFBRTtZQUM5QyxNQUFNLE9BQU8sR0FBUSxPQUFPLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQTtZQUU5QyxNQUFNLE1BQU0sR0FBRyxJQUFJLFdBQUssQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUE7WUFFdEMsTUFBTSxRQUFRLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDLFFBQVEsQ0FBQTtZQUMzQyxNQUFNLENBQUMsR0FBRyxJQUFJLFFBQVEsRUFBRSxDQUFBO1lBQ3hCLENBQUMsQ0FBQyxLQUFLLEdBQUcsR0FBRyxFQUFFLENBQUMsU0FBUyxDQUFBO1lBQ3pCLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFBO1lBQzVCLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUE7WUFFWixPQUFPLE1BQU0sQ0FBQyxRQUFRLENBQUMsT0FBTyxFQUFFLFFBQVEsRUFBRSxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUE7UUFDdkQsQ0FBQyxDQUFBO0lBdEJELENBQUM7Q0F1Qko7QUFqQ0Qsa0NBaUNDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtJbnN0YW5jZU9wdGlvbnMsIElPQ29udGV4dCwgSmFudXNDbGllbnQsIFZCYXNlfSBmcm9tICdAdnRleC9hcGknXG5cbmNvbnN0IEZJVkVfU0VDT05EU19NUyA9IDUgKiAxMDAwXG5cbmV4cG9ydCBjbGFzcyBWQmFzZUNsaWVudCBleHRlbmRzIEphbnVzQ2xpZW50IHtcbiAgICBwdWJsaWMgY29uc3RydWN0b3IoY29udGV4dDogSU9Db250ZXh0LCBvcHRpb25zPzogSW5zdGFuY2VPcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKGNvbnRleHQsIHtcbiAgICAgICAgICAgIC4uLm9wdGlvbnMsXG4gICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgLi4uKG9wdGlvbnMgJiYgb3B0aW9ucy5oZWFkZXJzKSxcbiAgICAgICAgICAgICAgICBWdGV4SWRDbGllbnRBdXRDb29raWU6IGNvbnRleHQuYXV0aFRva2VuXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdGltZW91dDogRklWRV9TRUNPTkRTX01TLFxuICAgICAgICB9KVxuICAgIH1cblxuICAgIHB1YmxpYyBnZXRTZWNyZXQgPSAoZmlsZU5hbWU6IGFueSkgPT4ge1xuICAgICAgICBjb25zdCBzZXJ2aWNlOiBhbnkgPSBwcm9jZXNzLmVudi5WVEVYX0FQUF9OQU1FXG5cbiAgICAgICAgY29uc3QgY2xpZW50ID0gbmV3IFZCYXNlKHRoaXMuY29udGV4dClcblxuICAgICAgICByZXR1cm4gY2xpZW50LmdldEZpbGUoc2VydmljZSwgZmlsZU5hbWUpXG4gICAgfVxuXG4gICAgcHVibGljIHNhdmVGaWxlID0gKGZpbGVOYW1lOiBzdHJpbmcsIGRhdGE6IGFueSkgPT4ge1xuICAgICAgICBjb25zdCBzZXJ2aWNlOiBhbnkgPSBwcm9jZXNzLmVudi5WVEVYX0FQUF9OQU1FXG5cbiAgICAgICAgY29uc3QgY2xpZW50ID0gbmV3IFZCYXNlKHRoaXMuY29udGV4dClcblxuICAgICAgICBjb25zdCBSZWFkYWJsZSA9IHJlcXVpcmUoJ3N0cmVhbScpLlJlYWRhYmxlXG4gICAgICAgIGNvbnN0IHMgPSBuZXcgUmVhZGFibGUoKVxuICAgICAgICBzLl9yZWFkID0gKCkgPT4gdW5kZWZpbmVkXG4gICAgICAgIHMucHVzaChKU09OLnN0cmluZ2lmeShkYXRhKSlcbiAgICAgICAgcy5wdXNoKG51bGwpXG5cbiAgICAgICAgcmV0dXJuIGNsaWVudC5zYXZlRmlsZShzZXJ2aWNlLCBmaWxlTmFtZSwgcywgZmFsc2UpXG4gICAgfVxufSJdfQ==